$(document).ready(function () {
        load();
});
function viewMessage(data){
    alert();
console.log("dddddddddd", JSON.stringify(data))
}
function load() {
    $("#contactsTable").hide(),
        $("#emptyMessage").hide(),
        $("#loading").show(),
        api.contacts
            .get()
            .success(function (e) {
                
                (contacts = e.data),
                    $("#loading").hide(),
                    0 < contacts.length
                        ? ($("#contactsTable").show(),
                            (contactsTable = $("#contactsTable").DataTable({
                                destroy: !0,
                                aaSorting: [[0, 'desc']],
                                columnDefs: [{ orderable: !0, targets: "no-sort", }],
                            })),
                            contactsTable.clear(),
                            (contactsRows = []),
                            $.each(contacts, function (e, a) {
                                let d= JSON.stringify(a);
                                contactsRows.push([
                                    escapeHtml(a.message_type), 
                                    escapeHtml(a.first_name), 
                                    escapeHtml(a.last_name), 
                                    escapeHtml(a.organization_name), 
                                   
                                    moment(a.created_date).format("MMMM Do YYYY"),
                                    `<a class="showInfo" data-value=\'${(d)}\'><i style='font-size:24px; margin-right:10px' class="fa fa-eye" ></i></a>`+
                                    "<i style='color:red; font-size:24px; margin-right:10px' class='fa fa-trash-o' onclick='deleteContact("+a.id+")'></i>",
                                ]);
                                
                            }), 
                            contactsTable.rows.add(contactsRows).draw(),
                            $('[data-toggle="tooltip"]').tooltip())
                        : $("#emptyMessage").show();
            })
            .error(function () {
                $("#loading").hide(), errorFlash("Error fetching pages");
            });
}
$(document).on("click",".showInfo",function(){
    console.log($(this).data('value'));
    $("#first_name").val($(this).data('value').first_name)
    $("#last_name").val($(this).data('value').last_name)
    $("#organization_name").val($(this).data('value').organization_name)
    $("#email").val($(this).data('value').email)
    $("#phone_number").val($(this).data('value').phone_number)
    $("#message_type").val($(this).data('value').message_type)
    $("#created_date").val($(this).data('value').created_date)
    $("#message").val($(this).data('value').message)
    $('#messageModal').modal("show");
    
})

var deleteContact = function (e) {
    Swal.fire({
        title: "Are you sure?",
        text: "This will delete the contact message. This can't be undone!",
        type: "warning",
        animation: !1,
        showCancelButton: !0,
        confirmButtonText: "Delete",
        confirmButtonColor: "#428bca",
        reverseButtons: !0,
        allowOutsideClick: !1,
        preConfirm: function () {
            return new Promise(function (a, t) {
                api.contactId
                    .delete(e)
                    .success(function (e) {
                        a();
                    })
                    .error(function (e) {
                        t(e.responseJSON.message);
                    });
            });
        },
    }).then(function (e) {
        e.value &&
            Swal.fire(
                "Contact Message Deleted!",
                "This contact message has been deleted!",
                "success"
            ),
            $('button:contains("OK")').on("click", function () {
                location.reload();
            });
    });
};